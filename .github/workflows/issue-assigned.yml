name: Issue Assignment â€“ Remove Unapproved Label

on:
  workflow_call:
  
  # Direct trigger for this repository
  issues:
    types: [assigned]

permissions:
  contents: read
  issues: write

jobs:
  remove-unapproved-label:
    name: Remove Unapproved Label when issue is assigned
    runs-on: ubuntu-latest

    steps:
      - name: Remove unapproved label
        uses: actions/github-script@v7
        with:
          script: |
            const { owner, repo } = context.repo;
            const issue_number = context.issue.number;

            const apiParams = { owner, repo, issue_number };

            // Get current labels on the issue
            const { data: labelList } = await github.rest.issues.listLabelsOnIssue(apiParams);

            const unapprovedLabel = labelList.find(label =>
              label.name.toLowerCase().includes('unapprov')
            );

            // Remove unapproved label if it exists
            if (unapprovedLabel) {
              try {
                await github.rest.issues.removeLabel({
                  owner,
                  repo,
                  issue_number,
                  name: unapprovedLabel.name,
                });
                console.log(`Removed label: ${unapprovedLabel.name}`);
              } catch (err) {
                if (err.status !== 404) throw err;
              }
            } else {
              console.log("No unapproved label found");
            }
